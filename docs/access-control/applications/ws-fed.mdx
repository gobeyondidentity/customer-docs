---
title: WS-Fed Integration Guide
id: wsfed
description: "Learn about the steps to complete the process to set up Beyond Identity for your Entra environment through WS-Fed."
slug: /access-control/applications/wsfed
keywords:
  - microsoft
  - entra
  - wsfed
pagination_next: null
pagination_prev: null
last_update:
  date: 2025-01-30
  author: Jerome Villegas
draft: false
hide_table_of_contents: false
hide_title: false
hide_breadcrumbs: false
doc_type: overview
displayed_sidebar: mainSidebar
---

## Overview

This guide is for delegating authentication to Beyond Identity for your Entra environment through WS-Fed.
Integrating Beyond Identity with your Entra environment through WS-Fed allows your users to authenticate with Beyond Identity, a passwordless, phishing-resistant, multi-factor authentication solution.

This guide covers the steps required to complete the integration.

## Stage summary

The integration setup consists of the five stages below. Each stage covers the initial set up for continuing the integration process on each respective platform. Follow the guide in linear order to complete the integration.

| Stage | Summary | Microsoft Entra ID | Beyond Identity |
| :---- | :---- | :---- | :---- |
| [I](#stage-i) | Initial set up | - N/A | - [Set up WS-Fed application in Beyond Identity](#-set-up-ws-fed-application-in-beyond-identity) |
| [II](#stage-ii) | System for Cross-domain Identity Management (SCIM) implementation | - [Create SCIM application in Microsoft Entra ID](#-create-scim-application-in-microsoft-entra-id)<br></br>- [Enter SCIM credentials in Microsoft Entra ID](#-enter-scim-credentials-in-microsoft-entra-id)<br></br>- [Update Attribute Mappings for SCIM in Microsoft Entra ID](#-update-attribute-mappings-for-scim-in-microsoft-entra-id)<br></br>- [Provision users in Beyond Identity using the Entra ID SCIM application](#-provision-users-in-beyond-identity-using-the-entra-id-scim-application) | - [Set up SCIM application in Beyond Identity](#-set-up-scim-application-in-beyond-identity) |
| [III](#stage-iii) | User Enrollment | - N/A | - [Assign application to users](#-assign-application-to-users)<br></br>- [Create Entra ID Bookmark App](#-create-entra-id-bookmark-app)<br></br>- [Enroll users with passkeys](#-enroll-users-with-passkeys) |
| [IV](#stage-iv) | Domain Federation | - [Executing Powershell Script for Domain Federation](#-executing-powershell-script-for-domain-federation)| - [Get Powershell Script from WS-Fed Application](#-get-powershell-script-from-ws-fed-application) |
| [V](#stage-v) | Add New Users to Entra ID | - [Add new users after federation](#-add-new-users-after-federation) | - N/A |

## Prerequisites

To get started with the integration, view the following prerequisites.

### Microsoft Entra ID

This information contains the necessary items for integrating with Beyond Identity.

- Microsoft Entra ID Global Administrator privileges
- Active Entra ID P1 license
- Domain added to Entra, must not be federated
  - NOTE: If the domain is already federated, complete the unfederating process before continuing.
- Powershell configurations for administrators

### Beyond Identity requirements

The list below covers the basic Beyond Identity requirements for the integration.

- Secure Access Tenant with Super Administrator Role
  - Use an existing account, or [sign up here](https://www.beyondidentity.com/get-demo) to create a new Beyond Identity account
- Have at least two devices and two Super Admin roles configured*
  - **Recommended, optional*

# Steps

Follow the steps in the sections below to complete your integration for Beyond Identity and Microsoft Entra ID.

## Legend

The sections below use these two color codings to identify the steps for separate platforms. Use a separate browser window when following instructions for each platform.

ðŸ”µ **Beyond Identity** - Beyond Identity platform tasks are highlighted in blue.

ðŸŸ  **Microsoft Entra ID** - Microsoft Entra ID platform and Powershell tasks are highlighted in orange.

## Stage I

The sections here are for the initial setup between Beyond Identity and Microsoft Entra ID.
This is for setting up the WS-Fed application in the Beyond Identity Console.

### ðŸ”µ Set up WS-Fed application in Beyond Identity

The following section covers setting up a WS-Fed application in the Beyond Identity console. This WS-Fed application is the configuration
on the Beyond Identity side for delegating authentication to Beyond Identity.

1. Navigate to your Beyond Identity Admin Console.
1. On the left-hand navigation under **Access Control**, click **Applications**.
1. Select the **Browse Applications** tab.
1. Click the **WS-Fed** tile to proceed.
1. Click **Add WS-FED**.
1. Under **General** â†’ **Display Name**, input `Microsoft Entra ID` into the text field.
1. Under the **Configuration** section, input the following information into the respective fields.
    - **ACS URL (SSO URL)*** - `https://login.microsoftonline.com/login.srf`
    - **Audience URL (Entity ID)*** - `urn:federation:MicrosoftOnline`
1. For the **Subject User Name Attribute** field, select **External ID** in the dropdown.
    - This field is the value that will be present in the WS-Fed token after Beyond Identity authenticates the user.
    This is how Entra matches the Beyond Identity user to the user in Entra.
1. For the **Attribute Statements (Optional)** section, use the table below to input the additional 4 attributes.
These are additional attributes sent in the WS-Fed token to Entra during the authentication process.

| Service Provider Attribute Name | Name Format | Beyond Identity Attribute Name | Namespace |
|---|---|---|---|
| `immutableID` | unspecified | External ID | `http://schemas.microsoft.com/LiveID/Federation/2008/05` |
| `emailaddress` | unspecified | Email | `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress` |
| `UPN` | unspecified | Username | `http://schemas.xmlsoap.org/claims` |
| `authnmethodsreferences` | unspecified | Custom static string `http://schemas.microsoft.com/claims/multipleauthn` | `http://schemas.microsoft.com/claims` |

10. Click **Save Changes** at the top of the page.

## Stage II

The Stage II sections cover the System for Cross-Domain Identity Management (SCIM) implementation between Beyond Identity as the inbound platform and Microsoft Entra ID as the outbound platform.
SCIM is used to populate users from your Microsoft Entra ID directory to the Beyond Identity directory.
The SCIM protocol will automatically update any changes in your Microsoft Entra ID directory to the Beyond Identity directory.

:::note
This means that the Entra ID directory is your source of truth. Any changes made to your directory **should occur in Microsoft Entra ID** and will be reflected in Beyond Identity directory.
:::


### ðŸŸ  Create SCIM application in Microsoft Entra ID

This will create a SCIM application in Microsoft Entra ID that will be used to provision users to Beyond Identity.

1. Navigate to your Microsoft Entra ID Admin Console at [https://portal.azure.com](https://portal.azure.com).
1. Navigate to **Microsoft Entra ID**.
1. On the left-hand navigation, click **Manage** â†’ **Enterprise applications**.
1. Click **+ New application**.
1. Click **+ Create your own application**.
1. For field **What's the name of your app?**, input `Beyond Identity SCIM`.
1. Click **Create**.
1. Under the **Getting Started** section, click **1. Assign users and groups**.
1. Click **+ Add user/group**.
1. On the left-hand navigation, under **Users and groups**, click **None Selected**.
1. Select the users and groups that will be using Beyond Identity authentication. This should be all the users in the domain that you
will federate later.
1. Once you have selected the users and groups, click **Assign** at the bottom of the page.
1. Now, on the left-hand navigation, click **Manage** â†’ **Provisioning**.
1. This should bring you to a preview of the application. On the left-hand navigation, click **Manage** â†’ **Provisioning**.
   - We know that the past two steps are the exact same, but Entra ID is hard to navigate and it just be like that.
1. For the **Provisioning Mode**, set to **Automatic**.
1. A new section, **Admin Credentials**, should have appeared.
1. For the next part, you will go back to the Beyond Identity console to get the SCIM credentials to input into the **Admin Credentials** section.


### ðŸ”µ Set up SCIM application in Beyond Identity

This will get the SCIM credentials from Beyond Identity to enter into the Entra ID SCIM application you just created.
This step enables Entra ID to push users and groups from your Entra ID directory into your Beyond Identity directory.

1. Navigate to your Beyond Identity Admin Console.
1. On the left-hand navigation, click **Access Control** â†’ **Applications**.
1. Select the **Browse Applications** tab.
1. Click the **SCIM** tile to proceed.
1. Click **Add SCIM**.
1. Under **General** â†’ **Display Name**, input `Microsoft Entra ID SCIM` into the text field.
1. Under the **Configure inbound provisioning section**, you will need the following 2 values:
   - **SCIM URL**
   - An API Bearer token you generate in the next step.
1. To generate the API Bearer token, go to the **Bearer tokens** section and click the **Add Bearer Token** button.
1. For the **Name** field, input `Microsoft Entra ID SCIM Token`. You can leave the expiration field as the default value.
1. Click **Add token**.
1. Copy the value and store in a secure location.
1. Click **Save Changes** at the top of the page.

:::note
The Beyond Identity bearer token for the inbound SCIM has an expiration date. To ensure the SCIM implementation doesn't break, the token must be updated after the initial token expires.

Entra ID does not support SCIM with `client credentials`, which is a service-to-service authentication protocol that automatically refreshes the tokens. We will look into alternative solutions to ensure that you don't have to manually update the token from time to time.
:::

### ðŸŸ  Enter SCIM credentials in Microsoft Entra ID

1. Navigate back to your SCIM application that you created in [Create SCIM application in Microsoft Entra ID section](#-create-scim-application-in-microsoft-entra-id).
1. Under **Admin Credentials**, input the following values:
   - `Tenant URL`: the value of `SCIM URL` from the section above.
   - `Secret Token`: the Bearer token that you created from the section above.
1. Click **Test Connection**.
   1. If the test connection is successful, click **Save**.
   1. If the test connection is unsuccessful, go back to the [Set up SCIM application in Beyond Identity section](#-set-up-scim-application-in-beyond-identity) and ensure the correct values were copied over.
1. Click **Save**.
1. You should see another new section, **Mappings**, appear. Go to the next section for next steps.

### ðŸŸ  Update Attribute Mappings for SCIM in Microsoft Entra ID

This section covers the attribute mappings for the SCIM application in Microsoft Entra ID.
This ensures that your Entra ID user attributes maps correctly to the Beyond Identity user attributes.
This section is definitely confusing (as the rest of the guide has been), but bear with us, we're almost there.

1. Under the **Mappings** section, click **Provision Microsoft Entra ID Users**.
1. At the bottom of the **Attribute Mapping** section, click **Show advanced options** checkbox.
1. Click **Edit attribute list for customappsso**.
1. At the bottom, add the following attribute:

    | Name | Type |
    |---|---|
    | `emails[primary eq true].value` | String |

1. Click **Save**.
1. Now, under the **Attribute Mappings** section, click **Add New Mapping**.
1. The following configuration will apply (all other fields can be left as default):
   - **Source attribute**: `mail`
   - **Target attribute**: `emails[primary eq true].value`
8. Click **Save**.

:::note
The reason we need to do this is because in the SCIM spec, there are 2 types of emails for the user. A `primary` email and a `work` email.
The default Entra ID SCIM configuration maps the user's email into the `work` email, which Beyond Identity does not currently support.
Beyond Identity does however, support the `primary` email, which is why we do this custom mapping here.
:::


9. We need to edit one last thing in the configuration here. Under the **Attribute Mappings** list, find the `externalId` attribute.
10. In that row, click the `Edit` button.
11. For the **Source attribute** field, select `immutableId`.
12. Click **Save**.
:::note
This step is done so that when Entra ID populates the Beyond Identity directory, the `immutableId` is set as the `External ID` field in Beyond Identity.
This is the unique value that allows matching of identities in your Entra ID directory and Beyond Identity directory.
:::

13. Now, save all the changes we made to **Attribute Mapping** by clicking **Save** at the top of the page.
14. Almost done! In the next section, you will provision users from your Entra ID directory to the Beyond Identity directory.

### ðŸŸ  Provision users in Beyond Identity using the Entra ID SCIM application

Nice! You're on the last step here. This section will provision users from your Entra ID directory to the Beyond Identity directory.

1. Navigate back to your SCIM application in Entra ID.
1. Navigate to the **Overview** section.
1. Click **Start Provisioning**.

:::note
This process could take up to 30 minutes to complete.
Entra ID will also push changes to the Beyond Identity directory via SCIM on a fixed interval (typically 40 minutes).
:::

4. Once this process completes, go back to your Beyond Identity Console.
5. Click on **Identities** and you should see all your users populated!


## Stage III

This section outlines the user enrollment process, which includes assigning users to the Beyond Identity application and ensuring they register a passkey on their device(s).

We complete this step before federating the domain because domain federation in Entra ID is an **all-or-nothing operation** when it comes to authentication.

Once authentication is switched to Beyond Identity, users must have a Beyond Identity passkey to log in successfully. Without one, they will be locked out.

To prevent any disruptions to your organization, it is critical that all users register a passkey on their device(s) before proceeding with domain federation in Stage IV.

### ðŸ”µ Assign application to users

In this section, we will assign your users the WS-Fed application that we created in [Stage I](#stage-i). This ensures that when they login to Entra ID with their passkey, they successfully authenticate with Beyond Identity.

1. Navigate to your Beyond Identity Admin Console.
1. On the left-hand navigation, click **Access Control** â†’ **Applications**.
1. Go to your **Microsoft Entra ID** WS-Fed application that you created in [Stage I](#stage-i).
1. Click the **Assignments** tab at the top.
1. Click the **Add Assignments** drop down.
1. Add the users and groups that are authenticating via Beyond Identity (this should be ALL your users).
1. Click **Save Changes** at the top of the page once completed.

### ðŸ”µ Create Entra ID Bookmark App

In this section, we will set up a **Bookmark App**. When your users complete the enrollment process, they are redirected to the Beyond Identity dashboard. To prevent user confusion, we will put an app tile that redirects the user to the Azure Portal.

1. Navigate to your Beyond Identity Admin Console.
1. On the left-hand navigation, click **Access Control** â†’ **Applications**.
1. Select the **Browse Applications** tab.
1. Click on the **Bookmark** tile.
1. Click **Add Bookmark**.
1. Fill in the following Fields:
   1. **Display Name**: `Azure Portal`
   1. **Login Link**: `https://portal.azure.com`
   1. **App Tile**: Upload an Azure Icon.
1. Click **Save Changes** at the top.
1. Navigate to the **Assignments** tab at the top.
1. Click the **Add Assignments** drop down.
1. Add the users and groups that are authenticating via Beyond Identity (this should be ALL your users).
1. Click **Save Changes** at the top.


### ðŸ”µ Enroll users with passkeys

In this section, we will get your end users set up with a passkey on their device. All your users MUST have a passkey registered on their device(s) before federating the domain, or they will be locked out.

1. On the Beyond Identity console, navigate to **Identities** â†’ a specific user â†’ **Passkeys** tab.
1. New users have no passkeys added. Click **Add a passkey**.
1. Under Identity Verification Method, select **Magic link**.
1. For the Delivery Method option, select **Send email** or **Generate link.**
1. Click the **Send enrollment** button.
   1. For the **Send email** option, the email connected to that identity receives a Beyond Identity email for the process to register a passkey.
   2. For the **Generate link** option, a URL is generated from Beyond Identity. This link is for sharing with the user for them to register a passkey.
1. When the user goes through the enrollment process, they will go through an interactive guide with the following 2 steps:
   1. Download the Beyond Identity Platform Authenticator - this is the app that is required for Beyond Identity authentication.
   2. Enroll a passkey on their device.

:::note
Ensure all your users have enrolled in passkeys before proceeding with the next step.
:::

## Stage IV Domain Federation

In this step, we will federate your Azure domain to use Beyond Identity authentication.

:::danger
Ensure all your users have enrolled in passkeys before proceeding with the next step. Domain federation in Entra ID is an **all-or-nothing operation** when it comes to authentication. If any users do not have passkeys, they will be locked out.
:::


### ðŸ”µ Get Powershell Script from WS-Fed Application

We have a generated Powershell script for you to run!

1. Navigate to your Beyond Identity Admin Console.
1. On the left-hand navigation, click **Access Control** â†’ **Applications**.
1. Go to your **Microsoft Entra ID** WS-Fed application that you created in [Stage I](#stage-i).
1. Under **Configuration**, click the **View Federation Script** button.
1. Enter in the following values:
   - **Domain Name**: Your domain name that you want federated. It should not have a leading period. Ex. `beyondidentity.com`.
   - **Logoff Url**: You can set a logoff URL, or leave it as the default value.
1. Download or copy the script. You will need it in the next step.

### ðŸŸ  Executing Powershell Script for Domain Federation

These steps are for executing the script in Powershell to federate the domain.

1. In your Powershell environment, run the script from the step above.
1. For the Security warning pop up, click **Run once**.
1. The browser window appears for the log in to Microsoft. Continue to pick your account for the login.
1. The domain is federated after logging in. According to Microsoft, domain federation can take up to 60 Minutes.

## Stage V

This outlines the process for adding new users to your Entra ID environment.

### ðŸŸ  Add new users after federation

If you add users to Entra after federating your domain, you may encounter the `sourceAnchor` issue. To prevent this, use the following Powershell script to create new users after federation.

Run the PowerShell script below to create new users and set the `immutableID` value for proper mapping, ensuring a seamless integration. If you need further assistance, contact your Beyond Identity representative.

```
Install-Module MSOnline
Connect-MsolService
$upn = "example@sample.com"
Write-Output "Calling Get-MsolUser"
$user = Get-MsolUser -UserPrincipalName $upn
Write-Output "User $user"
$uuid = [system.convert]::ToBase64String(([GUID]$user.objectID.Guid).ToByteArray())
Write-Output "$uuid"
Set-Msoluser -UserPrincipalName $upn -ImmutableID $uuid
```

:::success
Congratulations! You've completed your Beyond Identity integration with Entra ID!
:::
